A lo largo del documento se han descrito los objetivos de este Trabajo Fin de Grado, la infraestructura hardware y software utilizada, el software desarrollado que incluye el driver MavLinkServer en JdeRobot, y una versión nueva de la herramienta para la teleoperación. Se ha detallado el diseño, la implementación del driver y de la herramienta de la teleoperación. Además, las pruebas realizadas de ambas herramientas conjuntamente en distintos escenarios, uno para que el robot aéreo comunicándose mediante MavLinkServer junto a la herramienta UAV Viewer, otro para la integración del UAV Viewer con el robot aéreo Parrot y otro para que el UAV Viewer se integre con el simulador Gazebo y tener una cobertura completa para cualquier tipo de escenario. En este capítulo se exponen las conclusiones obtenidas durante todo el proceso y los trabajos futuros que pueden continuar o mejorar al actual.

\section{Conclusiones}

El principal objetivo de este trabajo era proponer una solución para el desarrollo de nuevas aplicaciones en drones cuya placa base se comunique mediante el protocolo MavLink. Para conseguir dicho objetivo, en primer lugar se llevó a cabo el desarrollo de un driver que permitiera el control del drone y la lectura de sus sensores desde cualquier componente de la plataforma JdeRobot. En segundo lugar, y haciendo uso de la plataforma desarrollada, se diseñó y se construyó una herramienta que nos permitiera pilotar cualquier tipo de dron soportando en el entorno una nueva versión de UAV-Viewer JdeRobot.

Teniendo en cuenta los resultados obtenidos durante las pruebas, detallados en el capítulo de 5, se puede afirmar que se ha logrado el objetivo propuesto. Se han cubierto todas las fases de un proyecto software, desde el análisis de requisitos y su especificación, hasta la realización de pruebas unitarias y de integración, pasando por el diseño e implementación. Además, se ha documentado el progreso mediante vídeos, imágenes y texto en la bitácora del proyecto, que es accesible públicamente desde Internet y donde cualquier usuario puede acceder a toda la documentación y el código generado en este trabajo. Este Trabajo Fin de Grado, se ha incluido en una ponencia que ha sido aceptada en el congreso CivilDron 2018 \cite{civilDron}, titulada "Programación de aplicaciones para drones con el entorno software JdeRobot". 

\begin{itemize}
\item El primer subobjetivo del proyecto era el desarrollo dentro de la plataforma JdeRobot de la infraestructura software que permitiera el acceso a los sensores y actuadores del cuadricóptero 3DR Solo Drone. Se comenzó con un estudio de las plataformas disponibles para el manejo y adquisición de los datos de los sensores de 3DR Solo Dron, desde el SDK oficial de MavLink. La base de este proyecto se basa en una apliación del Proyecto Fin de Grado de Jorge Cano \footnote{\url{http://jderobot.org/J.canoma-tfg}}, cuya versión sirvió como base pero se decidió reprogramarla desde 0. Los principales motivos fueron que no estaban bien diferenciadas las partes de servidor y cliente, lo cual era una fuente de problemas a la hora de codificar futuras mejoras. Finalmente se decidió desarrollar un envoltorio que permitiera la interacción de componentes JdeRobot con el SDK oficial de MavLink. El resultado es el componente MavLinkServer en Python 2.7 (también se hizo una versión en Python 3.5, pero fue necesario reprogramarla en 2.7 para integar en la version actual de JdeRobot, por compatibilidad con ROS Kinetic).

Una de las mayores ventajas de MavLinkServer es el uso de interfaces ICE, tanto las interfaces estándar de JdeRobot (que permiten que cualquier componente obtenga las imágenes del drone o enviar ficheros de configuración “en caliente”), como la interfaz especifica que permite el control del cuadricóptero desde otros componentes de una manera sencilla y eficiente. Dada la arquitectura
distribuida de ICE y la facilidad para implementar componentes en casi cualquier lenguaje de programación, hacen que interactuar con el 3DR Solo Dron a través del componente MavLinkServer sea una tarea sencilla, reduciendo la dificultad que supone trabajar con los dispositivos hardware a bajo nivel. La concurrencia del componente permite que éste pueda responder a las peticiones de otros
componentes mientras realiza otras acciones como la obtención de las imágenes del cuadricóptero o el envío de órdenes de movimiento



\item El segundo subobjetivo del proyecto era el diseño y desarrollo de una herramienta de teleoperación que gobernase el movimiento del cuadricóptero.

Ademas, se encontro la problemática que la interfaz ya existente, se diferenciaba mucho de un control de dron habitual, este cambio acerca a gente interesada en drones a la plataforma JdeRobot de una manera más simple. Este componente ya ha sido probado y utilizado en el Trabajo Fin de Grado de Jorge Vela \footnote{\url{http://jderobot.org/Jvela-tfg}}\cite{jvelaTFG}.

Utilizando las interfaces ICE que MavLinkServer ofrece, UAV Viewer las explota permitiendo la teleoperación del drone y el visionado de sus sensores. Este visor ha sido desarrollado para poder operar con otros drones, siempre y cuando éstos ofrezcan las interfaces necesarias (ver sección 5.1). La interfaz gráfica de éste componente está descrita en un fichero XML, lo que permite una rápida
modificación de la estética e incluso la funcionalidad de dicha interfaz. Los distintos hilos que componen la herramienta permiten atender debidamente la interfaz de usuario sin provocar bloqueos en la aplicación. Su diseño concurrente le permite desacoplar la interfaz gráfica de usuario de los hilos de control que gestionan la comunicación con MavLinkServer.

\item El tercer y último subobjetivo fue la validación experimental de ambos componentes desarrollados. En esta fase se realizaron una gran cantidad de pruebas, desde experimentos para justificar el correcto funcionamiento del driver y el componente UAV Viewer hasta pruebas de configuración o pruebas para estudio del comportamiento del sistema a bordo del cuadricóptero que muestran el correcto funcionamiento de la solución alcanzada.

\end{itemize}

En este proyecto, además de tener una serie de objetivos, también se definieron una serie de requisitos que la solución tenía que cumplir.

\begin{itemize}
\item El primer requisito era que la infraestructura a desarrollar para MAVLink versión 1.0 tenía que estar integrada en JdeRobot. El github oficial de MAVLink \footnote{\url{https://github.com/mavlink/mavlink}}, ha servido como apoyo y sobre todo como guía para las primeras etapas del desarrollo. Todas las aplicaciones desarrolladas en el proyecto son componentes JdeRobot, compatibles con JdeRobots 5.6. Están integradas en el repositorio oficial y han sido probadas por terceros (ver secciones 4.1 y 5.1).
\item El segundo requisito indica que la infraestructura debe ser eficiente computacionalmente. Todos los componentes desarrollados en el proyecto se basan en un diseño multihilo (ver secciones 4.1 y 5.1) que se aprovechan de las arquitecturas modernas multicore. Además, se ha estudiado el comportamiento, la carga y la duración de los ciclos de cada hilo lo cual nos permite ajustar la
duración de cada ciclo controlando así el tiempo que un hilo permanece ocioso.
\item El SDK oficial de MavLink para el desarrollo de aplicaciones, es un SDK complejo y a menudo complicado de entender. Para cumplir con el tercer requisito se implementaron las interfaces ICE, que permiten que un desarrollador que quiera hacer aplicaciones con 3DR Solo Dron utilizando MavLinkServer pueda utilizar el cuadricóptero como si fuera un objeto más de su clase obviando todas las dificultades que supone trabajar con dispositivos de bajo nivel. Es importante que las aplicaciones que se desarrollen funcionen con independencia del driver del drone: Solo 3DR, Parrot ArDrone, Gazebo.

\end{itemize}

Este es un proyecto heterogéneo y en él se han utilizado tecnologías variadas resumidas en el capítulo 3, como por ejemplo JdeRobot, MAVLink, Python o ICE: El desarrollo de software a bajo nivel que, haciendo uso del SDK de MavLink se utilizó para el desarrollo de MAVLinkServer; El desarrollo de interfaces gráficas de usuario con el uso de librerías gráficas que permitieron desarrollar las interfaces de UAV Viewer.

\section{Lecciones prácticas}
A lo largo de todas estas pruebas se aprendieron bastantes lecciones prácticas. Sin entrar en las especificaciones técnicas, el desarrollo de aplicaciones con el 3DR Solo Dron y en general con cualquier robot u otro dispositivo hardware conlleva una serie de inconvenientes. Al tratarse de un VANT el primer requisito indispensable para realizar aplicaciones sobre él es disponer de un lugar lo suficientemente amplio como para que el drone pueda volar sin que colisione con ningún objeto. Sobre todo en el comienzo del desarrollo, es altamente probable cometer errores en el código que provoquen que el cuadricóptero se estrelle, lo que trae consecuencias negativas como la rotura de algún componente del cuadricóptero, objetos que se encuentren en el mismo espacio o incluso daños físicos para las personas que se encuentren cerca. En las primeras etapas del proyecto se tuvieron que reponer distintos componentes, como por ejemplo las hélices, sin que ésto supusiera un gran problema. Además, y pese a las piezas reemplazadas, es una plataforma muy robusta que soportó numerosos accidentes a lo largo de este trabajo sin sufrir daño alguno.

Es importante tener en cuenta las normativa de drones vigente en cada momento, recientemente ha sido actualizada (Diciembre 2017), en la cual se especifícan con mayor detalle respecto a las anteriores normativas, el entorno y las situaciones climáticas en las que esta permitido el uso de los drones. 

El 3DR Solo Dron tiene una batería de litio de 5200mAh a 14.8V con una autonomía de vuelo de aproximadamente 30 minutos. La carga de la batería con el cargador oficial oscila entre 50 y 60 minutos. Si todo va bien, esto significa que disponemos de 30 minutos para realizar las pruebas necesarias con nuestro código. Si algo falla y no tenemos más baterías, supone que como mínimo tendremos que
esperar 50 minutos para reanudar las pruebas. Por esta razón es muy recomendable tener varios juegos de baterías y registrar todo el proceso que se realiza en las pruebas, desde la grabación en vídeo del vuelo del dron hasta el registro de los datos de la aplicación que nos ayuden a identificar el problema con exactitud. A veces puede resultar frustrante la corta vida de las baterías: aparte de disponer de un periodo de tiempo corto para realizar las pruebas, con el uso continuado de la batería la calidad de ésta se deteriora
provocando que la autonomía disminuya o que el manejo del cuadricóptero se vea afectado por la falta de potencia necesaria, con baja batería no se comporta igual que con batería completamente cargada.

El cuadricóptero dispone de un soporte para una cámara GoPro con estabilizador gimbal, lo que permite hacer aplicaciones muy enriquecidas ya que se puede abordar cualquier tipo de problema cambiando la posición inicial de la cámara.

\section{Trabajos Futuros}

En primer lugar se debería implementar el soporte para GPS, ya que aumentaría en gran medida el número de aplicaciones que se pueden realizar con MavLinkServer. 

Otra linea a seguir seria incorporar un sistema de autolocalización en interiores, este punto es delicado ya que la potencia del 3DR Solo Dron hace que sea peligroso volar en interiores con espacios reducidos.

Por último realizar un aterrizaje visual con el 3DR Solo Dron, este aterrizaje se ha probado en el Proyecto de Fin de Grado de Jorge Vela\cite{jorgeVelaTFG}.

